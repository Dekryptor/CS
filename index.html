<html>
	<head>
	<link rel="stylesheet" type="text/css" href="stylesmenu.css">
	<script type="text/javascript" src="lib/keyboard.js"></script>

	<script>
		KeyboardJS.on("esc", function(event, keys, combo){
			//Open console
		}, function(event, keys, combo){});
	
		function openNewGameMenu() {
			var menu = document.getElementById("newGameMenu");
			var menuHeight = screen.height / 2;
			var menuWidth = screen.width / 4.2;
			
			menu.style.height = menuHeight + "px";
			menu.style.width = menuWidth + "px";
			menu.style.marginTop = "-" + (menuHeight/2).toString() + "px";
			menu.style.marginLeft = "-" + (menuWidth/2).toString() + "px";
			menu.style.visibility = "visible";
		}
		
		function closeGameMenu() {
			var menu = document.getElementById("newGameMenu");
			console.log(menu);
			menu.style.visibility = "hidden";
		}
		
		function webGLStart() {
			var canvas = document.getElementById("canvas");
			initGL(canvas);
			
			download(cs.config.MAP_PATH, function(data) {
				//Parse map
				cs.map = new cs.Map(gl, data);
				
				download(cs.config.PLAYER_PATH, function(data) {
					//Hardcoded cs_assault position. TODO: Read this from the entity set
					cs.player = new cs.Player(gl, -186, 2597, 165, data);
					
					gl.clearColor(0.0, 0.0, 0.0, 1.0);

					//Set event handler for resizing the screen every time
					//the window changes size
					var resizeCallback = function() {
						canvas.width = window.innerWidth;
						canvas.height = window.innerHeight;
						gl.viewportWidth = window.innerWidth;
						gl.viewportHeight = window.innerHeight;
					};
					resizeCallback();
					window.addEventListener("resize", resizeCallback, false);
					
					//Listen for clicks on the canvas
					canvas.addEventListener("click", function() {
						//is the mouse not currently locked?
						if(!PointerLock.pointerLockElement()) {
							//Nope. Request locking
							PointerLock.requestPointerLock(canvas);
						}
					}, false);
					
					//Listen for pointer locking
					PointerLock.addPointerLockExchangeEventListener(document, function(e) {
						//Did the pointer just go from unlocked to locked?
						if(!!PointerLock.pointerLockElement()) {
							//Yep! Add mousemove listener
							PointerLock.addMouseMoveEventListener(document, rotatePlayer, false);
						}
						else { //Nope. Remove mouse move listener
							PointerLock.removeMouseMoveEventListener(document, rotatePlayer);
						}
					}, false);
					
					mainLoop();
				});
			});
		}
		
		function startGame() {
			var e = document.getElementById("map");
			var map = e.options[e.selectedIndex].value;
			window.location = "game.html#" + map;
		}
	</script>
	
	</head>
	<body>
		<table id="menu">
			<tr>
				<td><a href="#" onClick="openNewGameMenu()">New Game</a></td>
			</tr>
			<tr>
				<td><a href="#">Find Servers</a></td>
			</tr>
		</table>
	
		<div id="newGameMenu" style="visibility:hidden;">
			Map
			<select id="map">
				<option value="">< Random Map ></option>
				<option value="cs_assault.bsp">cs_assault</option>
				<option value="cs_italy.bsp">cs_italy</option>
			</select>
			<hr />
			
			<button id="menuStartButton" onclick="startGame()">Start</button>
			<button id="menuCancelButton" onclick="closeGameMenu()">Cancel</button>
		</div>
	</body>

</html>